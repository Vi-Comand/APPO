@model SISPR.Models.ViewModels.RegisterViewModel


@{
    ViewData["Title"] = "Регистрация";
}




<form role="form" class="needs-validation text-center bg-wh w-5" method="post" style="max-width:1200px; min-width:400px" id="contact-form" novalidate>
    <div class="card-body shadow-lg container   overflow-hidden p-4">
        <div class="row">
            <div class="col-12 col-md-9 row-alt " id="div_first">
                <h5 class="col-12">Создайте аккаунт ИРО</h5>
                @*<div class="row m-2">*@
                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="text" asp-for="F" class="form-control inp-theme" id="FaInput" placeholder="Иванов*" required>
                    <label for="floatingInput">Фамилия</label>
                    <div class="valid-feedback">
                        Все хорошо!
                    </div>
                    <div class="invalid-feedback">
                        Введите коректную фамилию
                    </div>
                </div>
                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="text" asp-for="I" class="form-control inp-theme" id="ImInput" placeholder="Иван*" required>
                    <label for="floatingInput">Имя</label>
                    <div class="valid-feedback">
                        Все хорошо!
                    </div>
                    <div class="invalid-feedback">
                        Введите коректное имя
                    </div>
                </div>

                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="text" asp-for="O" class="form-control inp-theme" id="OtInput" placeholder="Иванович">
                    <label for="floatingInput">Отчество</label>
                    <div class="valid-feedback">
                        Все хорошо!
                    </div>
                    <div class="invalid-feedback">
                        Введите отчество при его наличии
                    </div>
                </div>
                @*</div>
        <div class="row m-2">*@
                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="email" asp-for="Email" class="form-control inp-theme"onkeyup="ChangeEmail()" id="emailInput" placeholder="name@example.com" required>
                    <label for="floatingInput">Адрес электронной почты</label>
                    <div class="valid-feedback">
                        Все хорошо!
                    </div>
                    <div class="invalid-feedback">
                        Введите коректный адрес электронной почты
                    </div>
                </div>
                <div id="DivButPodtver" class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <a style="flex-direction: column; justify-content: center; display: inline-flex; "onclick="CheckEmail()" class="btn btn-sm btn-primary col-12 me-auto ">Подтвердить Email</a>
                </div>
                <div id="DivKodPodtver"  class="form-floating col-12 col-md-6 col-lg-4 pe-md-3 d-none">
                    <input type="text" class="form-control inp-theme " id="KodPodtver"  onkeyup="CheckKod(this.value)"placeholder="Введите код">
                    <label for="floatingInput">Введите код</label>
                 
                    <div id="DivKodInvalid"class="invalid-feedback">
                        Введите коректный код
                    </div>

                </div>
                <div id="DivPodtver"class="form-floating col-12 col-md-6 col-lg-4 pe-md-3 d-none">
                        
                    <h4> <label class="a">Подтверждено!</label> </h4>
</div>
                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="password" class="form-control inp-theme" asp-for="Password" id="passwordInput" placeholder="********" pattern=".{6,}" required>
                    <label for="passwordInput">Пароль</label>
                    <div class="invalid-feedback">
                        Пароль должен состоять не менее чем из 6 символов
                    </div>
                </div>
                <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                    <input type="password" class="form-control inp-theme" id="passwordCheckInput" asp-for="PasswordConfirm" placeholder="********" pattern=".{6,}" required>
                    <label for="passwordInput">Подтвердите пароль</label>
                    <div class="invalid-feedback">
                        Пароль не совподает
                    </div>
                </div>
                @*</div>*@

                <a asp-controller="Account" asp-action="Login" style="flex-direction: column; justify-content: center; display: inline-flex; " class="btn btn-sm btn-primary col-12 col-md-3 me-auto ">У меня есть акаунт</a>

                <button class="btn btn-lg btn-theme col-12 col-md-3 ms-auto me-md-3">Далее</button>

            </div>

                <div class="col-12 col-md-9 row-alt d-none" id="div_second">
                    <h5 class="col-12">Создайте аккаунт ИРО</h5>
                    @*<div class="row m-2">*@
                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <select class="form-select inp-theme" aria-label="Регион" id="regionInput">
                            <option selected>Выберите регион</option>
                            <option value="23">Краснодарский край</option>
                            <option value="69">Ростовская область</option>
                            <option value="26">Ставропольский край</option>
                        </select>
                        <label for="regionInput">Регион</label>
                        <div class="invalid-feedback">
                            Выберите регион
                        </div>
                    </div>
                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <select class="form-select inp-theme" aria-label="Муниципалитет" id="moInput">
                            <option selected>Выберите МО</option>
                            <option value="23">Краснодар</option>
                            <option value="69">Сочи</option>
                            <option value="26">Кущевский район</option>
                        </select>
                        <label for="moInput">МО</label>
                        <div class="invalid-feedback">
                            Выберите муниципалитет
                        </div>
                    </div>

                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <input type="text" class="form-control inp-theme" id="cityInput" placeholder="Краснодар">
                        <label for="cityInput">Населенный пункт</label>
                        <div class="invalid-feedback">
                            Введите отчество при его наличии
                        </div>
                    </div>
                    @*</div>
            <div class="row m-2">*@
                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <input type="text" class="form-control inp-theme" id="ooInput" placeholder="СОШ №1">
                        <label for="ooInput">Краткое наименование ОО</label>
                        <div class="invalid-feedback">
                            Введите краткое наименование ОО
                        </div>
                    </div>
                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <input type="text" class="form-control inp-theme mask-phone" id="telInput" placeholder="8-999-422-22-11" pattern=".{10,}">
                        <label for="telInput">Телефон</label>
                        <div class="invalid-feedback">
                            Пароль должен состоять не менее чем из 6 символов
                        </div>
                    </div>
                    <script>
                        $('.mask-phone').mask('+7 (999) 999-99-99');
                    </script>
                    <div class="form-floating col-12 col-md-6 col-lg-4 pe-md-3">
                        <input type="text" class="form-control inp-theme mask-snils" id="snilsInput" placeholder="111-111-111 11" pattern=".{10,}">
                        <label for="snilsInput">СНИЛС</label>
                        <div class="invalid-feedback">
                            Пароль не совподает
                        </div>
                    </div>
                    <script>
                        $('.mask-snils').mask('999-999-999 99');
                    </script>

                    <a asp-controller="Account" asp-action="Login" style="flex-direction: column; justify-content: center; display: inline-flex; " class="btn btn-sm btn-primary col-12 col-md-3 me-auto ">Назад</a>

                    <button class="btn btn-lg btn-theme col-12 col-md-3 ms-auto me-md-3 " asp-action="Register" asp-controller="Account">Регистрация</button>


                </div>



                <div class="col-3 reg">
                    <div width="200" height="200">
                        <img width="200" height="200" class="img-card-home" src="~/file/logo.png" />
                    </div>
                    <p>Один аккаунт - для всех сервисов Института развития образования Краснодарского края</p>
                </div>
            </div>
    </div>
</form>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>
    var HashKod;
    function ChangeEmail() {

        var divKodPodtver = document.getElementById("DivKodPodtver");
        divKodPodtver.classList.add("d-none");
        HashKod = null;
        var divPodtver = document.getElementById("DivPodtver");
        divPodtver.classList.add("d-none");
        divPodtver.value = null;
        var DivButPodtver = document.getElementById("DivButPodtver");
        DivButPodtver.classList.remove("d-none");
    }
function CheckKod(kod) {
    if (kod.length == 4) {
        jQuery.ajax({
            url: '/Account/CheckKod/',
            type: "POST",
            dataType: "json",
            data: { kod: kod, HashKod: HashKod },
            success: function (succeed) {
               
                if (succeed == "true") {
                   
                    var divKodPodtver = document.getElementById("DivKodPodtver");
                    divKodPodtver.classList.add("d-none");
                    var divPodtver = document.getElementById("DivPodtver");
                    divPodtver.classList.remove("d-none");
                    var divKodInvalid = document.getElementById("DivKodInvalid");
                    divKodInvalid.classList.remove("d-block");
                }
                else {
                  
                    var divKodInvalid = document.getElementById("DivKodInvalid");
                divKodInvalid.classList.add("d-block");
            
                }
            }
        });


    }

    }
    function CheckEmail() {
        var Email = document.getElementById("emailInput").value;
        var divKodPodtver = document.getElementById("DivKodPodtver");
        divKodPodtver.classList.remove("d-none");
       
        var DivButPodtver = document.getElementById("DivButPodtver");
        DivButPodtver.classList.add("d-none");
        alert(Email);
        jQuery.ajax({
            url: '/Account/ConfirmedEmailAjax/',
            type: "POST",
            dataType: "json",
            data: { Email: Email },
            success: function (query) {
                HashKod = query.hash;
                alert(HashKod);
                alert(query.messege);
            }
        });
    }




    //Пример стартового JavaScript для отключения отправки форм при наличии недопустимых полей

    var n = 0;
    (function() {
        'use strict'

        // Получите все формы, к которым мы хотим применить пользовательские стили проверки Bootstrap
        var forms = document.querySelectorAll('.needs-validation');

        // Зацикливайтесь на них и предотвращайте отправку

        Array.prototype.slice.call(forms)
            .forEach(function(form) {
                form.addEventListener('submit',
                    function(event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                            alert(1);
                            form.classList.add('was-validated');
                        } else if (n == 0) {

                            next();
                            n = 1;
                            form.classList.remove('was-validated');
                            event.preventDefault();
                            event.stopPropagation();
                        } else {
                            form.classList.remove('was-validated');
                        }
                        //form.classList.add('was-validated')
                    },
                    false);
            });


    })();


    function next() {
        var DivFirst = document.getElementById('div_first');
        var DivSecond = document.getElementById('div_second'); 
        var regInput = document.getElementById('regInput');
        DivFirst.classList.add("d-none");
        DivSecond.classList.remove("d-none");
        $('#regionInput').prop('required', true);
        $('#snilsInput').prop('required', true);
    }
</script>
